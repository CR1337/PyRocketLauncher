#!/bin/bash

export RED="\e[1;31m"
export CYAN="\e[1;36m"
export GREEN="\e[1;92m"
export RESET="\e[1;0m"

export BASE_DIR=/opt/rl
export APP_NAME="PyRocketLauncher"
export GITHUB_USER="CR1337"

info () {
    echo -e "${CYAN}INFO> $1 ${RESET}"
}
error () {
    >&2 echo -e "${RED}ERROR> $1 ${RESET}"
}
success() {
    echo -e "${GREEN}SUCCESS> $1 ${RESET}"
}

if [ "$EUID" -ne 0 ]; then
    error "Please execute as root!"
    exit 1
fi

if [ -d "$BASE_DIR/$APP_NAME" ]; then
    error "$APP_NAME is already installed!"
    exit 1
fi

info "Creating base directory..."
mkdir -p $BASE_DIR
cd $BASE_DIR

info "Updating apt repositories..."
apt -y update

info "Installing dependencies via apt..."
apt -y install git
apt -y install python3
apt -y install python3-pip

info "Cloning $APP_NAME repository from GitHub..."
git clone "https://github.com/$GITHUB_USER/$APP_NAME.git"

info "Installing dependecies via pip..."
python3 -m pip install -r requirements.txt

info "Adding bin directory to SECURE_PATH..."
SECURE_PATH=$(grep -oP 'secure_path="\K.*?(?=")' /etc/sudoers)
echo "Defaults	secure_path=\"$SECURE_PATH:$BASE_DIR/$APP_NAME/bin\"" >> /etc/sudoers.d/rl

success "Done"
